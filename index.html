<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GUANES | Justicia Digital Premium</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #0F172A; --brand: #2563EB; --accent: #F59E0B; --bg: #F0F4F8; --white: #ffffff; --gradient: linear-gradient(135deg, #2563EB 0%, #1E40AF 100%); }
        body { font-family: 'Outfit', sans-serif; background: var(--bg); color: #334155; margin: 0; line-height: 1.6; padding-top: 40px; }
        * { box-sizing: border-box; } a { text-decoration: none; }
        
        /* FLASH NEWS */
        .daily-flash-bar { background-color: #1e293b; color: white; padding: 10px 5%; font-size: 0.9rem; font-weight: 500; text-align: center; position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; display: flex; justify-content: center; align-items: center; gap: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .flash-tag { background: var(--brand); padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; }

        /* HEADER */
        header { background: linear-gradient(180deg, #ffffff 0%, #e2e8f0 100%); padding: 5rem 1rem 5rem; text-align: center; position: relative; }
        h1 { font-size: 3rem; font-weight: 800; color: var(--primary); margin: 0; line-height: 1.1; }
        .badge { background: #dbeafe; color: var(--brand); padding: 8px 20px; border-radius: 50px; font-weight: 700; font-size: 0.85rem; text-transform: uppercase; margin-bottom: 1.5rem; display: inline-block; }

        /* NEWS CARD */
        .news-section { padding: 0 5%; margin-top: -40px; position: relative; z-index: 10; }
        .news-card { background: white; max-width: 1000px; margin: 0 auto; border-radius: 12px; box-shadow: 0 15px 30px rgba(0,0,0,0.1); display: flex; overflow: hidden; border-left: 6px solid var(--accent); }
        .news-icon-box { background: var(--primary); color: var(--accent); padding: 1.5rem; min-width: 120px; text-align: center; display: flex; flex-direction: column; justify-content: center; }
        .news-content { padding: 1.5rem; flex-grow: 1; }
        .news-title { margin: 0 0 5px; color: var(--primary); font-size: 1.1rem; font-weight: 700; }
        
        /* SERVICES (INTERACTIVOS) */
        .services-section { padding: 4rem 5% 3rem; max-width: 1200px; margin: 0 auto; }
        .section-title { text-align: center; color: var(--primary); font-size: 2rem; margin-bottom: 2rem; font-weight: 800; }
        .services-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        
        .service-card { 
            background: white; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0; 
            display: flex; align-items: center; gap: 1rem; transition: 0.3s; 
            cursor: pointer; 
        }
        .service-card:hover { transform: translateY(-5px); border-color: var(--brand); box-shadow: 0 15px 30px rgba(37,99,235,0.15); }
        .s-icon { width: 50px; height: 50px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; flex-shrink: 0; }
        .s-info h3 { margin: 0; font-size: 1.1rem; color: var(--primary); }
        .s-info p { margin: 2px 0 0; font-size: 0.9rem; color: #64748b; }

        /* APP FORM */
        #app-generator { background: var(--primary); padding: 4rem 1rem; background-image: radial-gradient(#1e293b 1px, transparent 1px); background-size: 20px 20px; }
        .app-box { background: white; max-width: 800px; margin: 0 auto; border-radius: 20px; padding: 3rem; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); border-top: 6px solid var(--accent); }
        .input-group { margin-bottom: 1.5rem; }
        label { display: block; font-weight: 700; font-size: 0.95rem; margin-bottom: 0.5rem; color: #1e293b; }
        .input-control { width: 100%; padding: 14px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1rem; background: #f8fafc; transition: 0.3s; }
        .input-control:focus { outline: none; border-color: var(--brand); background: #fff; }
        .btn-generate { width: 100%; padding: 1.2rem; font-size: 1.2rem; font-weight: 800; color: white; background: var(--gradient); border: none; border-radius: 12px; cursor: pointer; margin-top: 1.5rem; text-transform: uppercase; box-shadow: 0 10px 15px -3px rgba(37,99,235,0.4); transition: 0.3s; }
        .btn-generate:disabled { background: #94a3b8; cursor: wait; }
        .hidden { display: none; }
        .highlight-box { padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem; border: 1px solid #e2e8f0; }
        .theme-laboral { background: #eff6ff; border-color: #bfdbfe; }
        .theme-inmuebles { background: #fff7ed; border-color: #fed7aa; }
        .theme-vehiculos { background: #ecfeff; border-color: #a5f3fc; }
        .theme-transito { background: #f0fdf4; border-color: #bbf7d0; } 
        .theme-salud { background: #fef2f2; border-color: #fecaca; } 
        .theme-civil { background: #faf5ff; border-color: #e9d5ff; } 
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        footer { text-align: center; padding: 2rem; color: #94a3b8; background: #020617; }
        @media(max-width: 600px) { .grid-2 { grid-template-columns: 1fr; } .news-card { flex-direction: column; } .daily-flash-bar { flex-direction: column; font-size: 0.8rem; } }
    </style>
</head>
<body>

    <div class="daily-flash-bar">
        <span class="flash-tag">HOY EN COLOMBIA:</span>
        <span id="dailyNewsText"><i class="fas fa-spinner fa-spin"></i> Cargando actualidad jur√≠dica...</span>
    </div>

    <header>
        <span class="badge">‚ú® Oficina Virtual 24/7</span>
        <h1>GUANES <span style="color:var(--brand);">LEGAL</span></h1>
        <p style="font-size: 1.2rem; max-width: 600px; margin: 10px auto; color: #475569;">Supervisi√≥n experta del Dr. Manuel Prada Forero.</p>
        <a href="#app-generator" class="btn-generate" style="display:inline-block; width:auto; padding: 1rem 2rem; margin-top:1rem;">Iniciar Tr√°mite Ahora</a>
    </header>

    <div class="news-section">
        <div class="news-card">
            <div class="news-icon-box"><i class="fas fa-bullhorn" style="font-size: 1.8rem;"></i><span style="font-weight: 700; margin-top: 5px;">DESTACADO</span></div>
            <div class="news-content">
                <span style="font-size: 0.75rem; color: #94a3b8; font-weight: 700;">OPORTUNIDAD DE DEMANDA</span>
                <h3 class="news-title">Corte Suprema: Se deben pagar horas extras en teletrabajo</h3>
                <p style="margin: 0; color: #475569;">Si su empleador le exige disponibilidad total en casa, usted tiene derecho a reclamar remuneraci√≥n suplementaria. Cons√∫ltenos.</p>
            </div>
        </div>
    </div>

    <section class="services-section">
        <h2 class="section-title">Nuestros Servicios ($50.000)</h2>
        <div class="services-grid">
            <div class="service-card" onclick="activarServicio('Laboral')"><div class="s-icon" style="background:#eff6ff; color:var(--brand);"><i class="fas fa-hard-hat"></i></div><div class="s-info"><h3>Laboral</h3><p>Liquidaci√≥n, Despidos.</p></div></div>
            <div class="service-card" onclick="activarServicio('Inmuebles')"><div class="s-icon" style="color:#ea580c; background:#fff7ed;"><i class="fas fa-home"></i></div><div class="s-info"><h3>Inmuebles</h3><p>Arriendos y Promesas.</p></div></div>
            <div class="service-card" onclick="activarServicio('Veh√≠culos')"><div class="s-icon" style="color:#0891b2; background:#ecfeff;"><i class="fas fa-car"></i></div><div class="s-info"><h3>Veh√≠culos</h3><p>Traspasos Carro/Moto.</p></div></div>
            <div class="service-card" onclick="activarServicio('Tr√°nsito')"><div class="s-icon" style="color:#166534; background:#f0fdf4;"><i class="fas fa-traffic-light"></i></div><div class="s-info"><h3>Fotomultas</h3><p>Derechos de Petici√≥n.</p></div></div>
            <div class="service-card" onclick="activarServicio('Salud')"><div class="s-icon" style="color:#dc2626; background:#fef2f2;"><i class="fas fa-heartbeat"></i></div><div class="s-info"><h3>Tutelas Salud</h3><p>Medicamentos y Citas.</p></div></div>
            <div class="service-card" onclick="activarServicio('Cobro')"><div class="s-icon" style="color:#7e22ce; background:#faf5ff;"><i class="fas fa-money-bill-wave"></i></div><div class="s-info"><h3>Cobro Deudas</h3><p>Recuperaci√≥n de Cartera.</p></div></div>
            <div class="service-card" onclick="activarServicio('Consultor√≠a')" style="grid-column: 1 / -1;"><div class="s-icon" style="color:#475569; background:#f1f5f9;"><i class="fas fa-gavel"></i></div><div class="s-info"><h3>Consultor√≠a Jur√≠dica</h3><p>An√°lisis de Viabilidad y Conceptos.</p></div></div>
        </div>
    </section>

    <section id="app-generator">
        <div class="app-box">
            <h2 style="text-align:center; color:var(--primary); margin-bottom: 2rem;">Radicaci√≥n de Caso</h2>
            <form id="legalForm">
                <div class="input-group">
                    <label style="color: var(--brand);">Seleccione el Tr√°mite:</label>
                    <select class="input-control" name="Menu" id="servicioSelect" onchange="toggleFields()" required style="background: #eff6ff; border-color: var(--brand); font-weight: 600;">
                        <option value="" disabled selected>üëá Seleccione aqu√≠...</option>
                        <option value="Liquidaci√≥n y Demandas Laborales">üë∑‚Äç‚ôÇÔ∏è Laboral: Liquidaci√≥n / Despido</option>
                        <option value="Contratos Inmobiliarios">üè† Inmuebles: Arriendo / Compraventa Casa</option>
                        <option value="Compraventa Veh√≠culos">üöó Veh√≠culos: Compraventa Carro/Moto</option>
                        <option value="Derecho de Petici√≥n y Fotomultas">üì∑ Tr√°nsito: Fotomultas / Comparendos</option>
                        <option value="Acciones de Tutela">üè• Salud: Tutela (Medicamentos/Citas)</option>
                        <option value="Cobro Jur√≠dico">üí∞ Civil: Cobro de Deudas (Cartera)</option>
                        <option value="Concepto de Viabilidad y An√°lisis de Caso">‚öñÔ∏è Consultor√≠a: Concepto Jur√≠dico</option>
                    </select>
                </div>

                <div class="highlight-box" style="border: 1px dashed #cbd5e1; background: #f8fafc;">
                    <h4 style="margin-top:0; color:#64748b;">üë§ Datos del Cliente (Quien contrata)</h4>
                    <div class="grid-2">
                        <div class="input-group"><label>Nombre Completo:</label><input type="text" class="input-control" name="Nombre" required></div>
                        <div class="input-group"><label>C√©dula / NIT:</label><input type="text" class="input-control" name="ID" required></div>
                    </div>
                    <div class="grid-2">
                        <div class="input-group"><label>Email:</label><input type="email" class="input-control" name="Correo" required></div>
                        <div class="input-group"><label>Ciudad:</label><input type="text" class="input-control" name="Ciudad" required></div>
                    </div>
                </div>

                <div class="highlight-box" style="border: 1px dashed #f87171; background: #fef2f2;">
                    <h4 style="margin-top:0; color:#b91c1c;">‚öñÔ∏è Datos de la Contraparte</h4>
                    <div class="grid-2">
                        <div class="input-group"><label>Nombre Contraparte:</label><input type="text" class="input-control" name="Contraparte" placeholder="Empresa, Persona o Entidad" required></div>
                        <div class="input-group"><label>C√©dula / NIT Contraparte:</label><input type="text" class="input-control" name="Contraparte_ID" placeholder="Obligatorio para Contratos/Demandas" required></div>
                    </div>
                </div>

                <hr style="border:0; border-top:1px solid #e2e8f0; margin:2rem 0;">

                <div id="camposLaborales" class="hidden highlight-box theme-laboral">
                    <h4 style="color:var(--brand);"><i class="fas fa-briefcase"></i> Detalle Laboral</h4>
                    <div class="grid-2"><div class="input-group"><label>Fecha Ingreso:</label><input type="date" class="input-control" name="fecha_inicio"></div><div class="input-group"><label>Fecha Retiro:</label><input type="date" class="input-control" name="fecha_fin"></div></div><div class="grid-2"><div class="input-group"><label>Salario ($):</label><input type="number" class="input-control" name="salario"></div><div class="input-group"><label>Motivo:</label><select class="input-control" name="motivo_salida"><option value="Despido Sin Justa Causa">Despido Injusto</option><option value="Renuncia Voluntaria">Renuncia</option><option value="Terminaci√≥n de Contrato">Fin de Contrato</option><option value="Despido Con Justa Causa">Despido Justo</option></select></div></div>
                </div>

                <div id="camposInmuebles" class="hidden highlight-box theme-inmuebles">
                    <h4 style="color:#ea580c;"><i class="fas fa-home"></i> Detalle del Contrato</h4>
                    <div class="input-group"><label>¬øCu√°l es su ROL?</label><select class="input-control" name="inmueble_rol"><option value="Soy el ARRENDADOR (Due√±o)">Soy el ARRENDADOR (Due√±o/Propietario)</option><option value="Soy el ARRENDATARIO (Inquilino)">Soy el ARRENDATARIO (Inquilino)</option><option value="Soy el VENDEDOR">Soy el VENDEDOR (Promesa de Venta)</option><option value="Soy el COMPRADOR">Soy el COMPRADOR (Promesa de Venta)</option></select></div>
                    <div class="input-group"><label>Tipo Contrato:</label><select class="input-control" name="inmueble_tipo"><option>Contrato de Arrendamiento</option><option>Promesa de Compraventa</option></select></div>
                    <div class="input-group"><label>Direcci√≥n Exacta del Inmueble:</label><input type="text" class="input-control" name="inmueble_direccion"></div>
                    <div class="grid-2"><div class="input-group"><label>Valor Canon / Venta ($):</label><input type="number" class="input-control" name="inmueble_valor"></div><div class="input-group"><label>Matr√≠cula Inmobiliaria:</label><input type="text" class="input-control" name="inmueble_matricula"></div></div>
                    <div class="grid-2"><div class="input-group"><label>Ficha Catastral (Opcional Arriendo):</label><input type="text" class="input-control" name="inmueble_catastral"></div><div class="input-group"><label>Fecha Inicio / Entrega:</label><input type="date" class="input-control" name="inmueble_fecha"></div></div>
                    <div class="input-group"><label>Si es Venta: ¬øD√≥nde y Cu√°ndo se firma Escritura?</label><div class="grid-2"><input type="text" class="input-control" name="inmueble_notaria" placeholder="Ej: Notar√≠a 5 de Bucaramanga"><input type="date" class="input-control" name="inmueble_fecha_escritura"></div></div>
                    <div class="input-group"><label>Uso del Inmueble:</label><select class="input-control" name="inmueble_uso"><option>Vivienda Urbana</option><option>Comercial</option><option>Oficina</option></select></div>
                </div>

                <div id="camposVehiculos" class="hidden highlight-box theme-vehiculos">
                    <h4 style="color:#0891b2;"><i class="fas fa-car"></i> Detalle Veh√≠culo</h4>
                    <div class="input-group"><label>¬øUsted Vende o Compra?</label><select class="input-control" name="vehiculo_rol"><option value="Soy el VENDEDOR">Soy el VENDEDOR</option><option value="Soy el COMPRADOR">Soy el COMPRADOR</option></select></div>
                    <div class="grid-2"><div class="input-group"><label>Placa:</label><input type="text" class="input-control" name="vehiculo_placa" style="text-transform:uppercase;"></div><div class="input-group"><label>Valor Negocio ($):</label><input type="number" class="input-control" name="vehiculo_valor"></div></div>
                    <div class="grid-2"><div class="input-group"><label>Marca:</label><input type="text" class="input-control" name="vehiculo_marca"></div><div class="input-group"><label>Modelo (A√±o):</label><input type="text" class="input-control" name="vehiculo_modelo"></div></div>
                    <div class="input-group"><label>No. Motor / Chasis (Recomendado):</label><input type="text" class="input-control" name="vehiculo_motor_chasis"></div>
                    <div class="input-group"><label>Gastos Traspaso:</label><select class="input-control" name="vehiculo_traspaso"><option>50/50</option><option>Comprador</option><option>Vendedor</option></select></div>
                </div>

                <div id="camposTransito" class="hidden highlight-box theme-transito">
                    <h4 style="color:#166534;"><i class="fas fa-traffic-light"></i> Datos Comparendo</h4>
                    <div class="grid-2"><div class="input-group"><label>Placa:</label><input type="text" class="input-control" name="transito_placa"></div><div class="input-group"><label>Fecha:</label><input type="date" class="input-control" name="transito_fecha"></div></div><div class="input-group"><label>Notificaci√≥n:</label><select class="input-control" name="transito_notificacion"><option>NO me notificaron</option><option>SI me notificaron</option></select></div>
                </div>

                <div id="camposSalud" class="hidden highlight-box theme-salud">
                    <h4 style="color:#dc2626;"><i class="fas fa-heartbeat"></i> Datos Tutela</h4>
                    <div class="input-group"><label>Hechos (Qu√© niegan):</label><input type="text" class="input-control" name="salud_negacion"></div><div class="input-group"><label>Urgencia:</label><select class="input-control" name="salud_riesgo"><option>Urgencia Vital</option><option>Calidad de Vida</option><option>Administrativo</option></select></div>
                </div>

                <div id="camposCivil" class="hidden highlight-box theme-civil">
                    <h4 style="color:#7e22ce;"><i class="fas fa-money-bill-wave"></i> Datos Deuda</h4>
                    <div class="grid-2"><div class="input-group"><label>Soporte:</label><select class="input-control" name="civil_tipo"><option>Letra de Cambio</option><option>Factura</option><option>Verbal</option></select></div><div class="input-group"><label>Vencimiento:</label><input type="date" class="input-control" name="civil_vencimiento"></div></div><div class="input-group"><label>Monto ($):</label><input type="number" class="input-control" name="civil_monto"></div>
                </div>

                <div id="campoRelato"><div class="input-group"><label>Detalles Adicionales:</label><textarea class="input-control" name="Relato" style="min-height: 100px;" placeholder="Cualquier otro detalle..."></textarea></div></div>
                
                <button type="submit" class="btn-generate" id="submitBtn"><i class="fas fa-credit-card"></i> PAGAR $50.000 Y GENERAR</button>
                <p style="text-align: center; font-size: 0.8rem; color: #666; margin-top: 10px;">
                    <i class="fas fa-lock"></i> Pago seguro v√≠a Wompi (Bancolombia). Satisfacci√≥n garantizada.
                </p>
            </form>
            <div id="statusMessage"></div>
        </div>
    </section>

    <footer style="background: #0f172a; color: #cbd5e1; padding: 3rem 1rem; margin-top: 4rem; border-top: 6px solid #2563EB;">
        <div style="max-width: 1000px; margin: 0 auto; text-align: center;">
            
            <div style="margin-bottom: 1.5rem;">
                <i class="fas fa-balance-scale" style="font-size: 2.5rem; color: #F59E0B; margin-bottom: 10px;"></i>
                <h3 style="color: white; margin: 0; font-size: 1.5rem;">Dr. Manuel Enrique Prada Forero</h3>
                <p style="margin: 5px 0; font-weight: 600; color: #94a3b8;">Abogado Titulado & Litigante</p>
                <div style="background: rgba(255,255,255,0.1); display: inline-block; padding: 5px 15px; border-radius: 50px; margin-top: 10px;">
                    <i class="fas fa-id-card"></i> T.P. 176.633 del C.S. de la J.
                </div>
            </div>

            <div style="background: #1e293b; padding: 1.5rem; border-radius: 12px; border: 1px dashed #475569; margin: 2rem auto; max-width: 600px;">
                <p style="margin-top: 0; color: #e2e8f0; font-size: 0.9rem;">
                    <i class="fas fa-shield-alt" style="color: #10b981;"></i> <strong>TRANSPARENCIA TOTAL:</strong> 
                    En GUANES Legal Tech operamos bajo estricta √©tica profesional. Puede verificar la vigencia de nuestra licencia directamente en el Registro Nacional de Abogados:
                </p>
                <a href="https://vigenciaspublicas.ramajudicial.gov.co/Certificados.aspx" target="_blank" style="color: #F59E0B; text-decoration: underline; font-weight: 700; font-size: 1rem;">
                    <i class="fas fa-external-link-alt"></i> Verificar T.P. 176.633 en Rama Judicial
                </a>
            </div>

            <p style="font-size: 0.8rem; opacity: 0.7;">
                ¬© 2026 GUANES Legal Tech. Todos los derechos reservados.<br>
                El uso de esta plataforma implica la aceptaci√≥n de nuestros t√©rminos de servicio. 
                Documentos generados con asistencia de IA bajo supervisi√≥n humana calificada.
            </p>
        </div>
    </footer>

<script>
        // ==========================================
        // 1. CONFIGURACI√ìN MAESTRA (PAGOS Y CEREBROS)
        // ==========================================
        const WOMPI_PUBLIC_KEY = "pub_prod_jzFdvrOaXRlOEHifpzvBpm0FKMsq9FLh"; // ‚úÖ SU LLAVE
        const PRECIO_DOCUMENTO = 5000000; // $50.000 COP (en centavos)
        
        const WEBHOOK_FORMULARIO = "https://guanes.app.n8n.cloud/webhook/cb4edfe2-eaea-47dd-8f97-22afccd72810"; 
        const WEBHOOK_NOTICIAS = "https://guanes.app.n8n.cloud/webhook/noticias-juridicas"; 

        // Inyectamos el script de Wompi din√°micamente para evitar errores
        const scriptWompi = document.createElement('script');
        scriptWompi.src = "https://checkout.wompi.co/widget.js";
        document.head.appendChild(scriptWompi);

        // ==========================================
        // 2. L√ìGICA DE NOTICIAS (PERIODISTA)
        // ==========================================
        async function cargarNoticias() {
            const newsBar = document.getElementById('dailyNewsText');
            const bigTitle = document.getElementById('mainNewsTitle');
            const bigDesc = document.getElementById('mainNewsDesc');

            try {
                const response = await fetch(WEBHOOK_NOTICIAS, { method: 'POST' });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Efecto visual de parpadeo
                    newsBar.style.opacity = 0;
                    if(bigTitle) bigTitle.style.opacity = 0;

                    setTimeout(() => {
                        // 1. BARRA SUPERIOR (Link Blanco)
                        // target="_blank" significa que abre en pesta√±a nueva para que no se vayan de su web
                        newsBar.innerHTML = `
                            <a href="${data.news_link}" target="_blank" style="color: white; text-decoration: none; cursor: pointer;">
                                <i class="fas fa-newspaper"></i> ${data.news_text} <i class="fas fa-external-link-alt" style="font-size: 0.7rem;"></i>
                            </a>`;
                        newsBar.style.opacity = 1;

                        // 2. TARJETA GRANDE (T√≠tulo con Link Azul)
                        if (bigTitle) {
                            const tituloLimpio = data.news_text.replace("√öLTIMA HORA: ", "");
                            
                            bigTitle.innerHTML = `
                                <a href="${data.news_link}" target="_blank" style="color: var(--primary); text-decoration: hover; cursor: pointer;">
                                    ${tituloLimpio} <i class="fas fa-external-link-alt" style="font-size: 1rem; color: var(--brand);"></i>
                                </a>`;
                            bigTitle.style.opacity = 1;
                        }

                        // 3. Descripci√≥n persuasiva
                        if (bigDesc) {
                            bigDesc.innerText = "Este evento jur√≠dico podr√≠a afectarlo. Haga clic en el t√≠tulo para leer la fuente original o inicie su tr√°mite con nosotros.";
                        }

                    }, 500);

                } else { throw new Error("Error conexi√≥n"); }
            } catch (e) {
                // Respaldo sin link (por si falla)
                const backup = "Corte Constitucional actualiza sentencias clave.";
                newsBar.innerHTML = backup;
                if(bigTitle) bigTitle.innerText = backup;
            }
        };

        // ==========================================
        // 3. NAVEGACI√ìN Y FORMULARIO
        // ==========================================
        function activarServicio(palabraClave) {
            const select = document.getElementById('servicioSelect');
            const formSection = document.getElementById('app-generator');
            formSection.scrollIntoView({ behavior: 'smooth' });
            for (let i = 0; i < select.options.length; i++) {
                if (select.options[i].text.includes(palabraClave) || select.options[i].value.includes(palabraClave)) {
                    select.selectedIndex = i;
                    break;
                }
            }
            toggleFields();
        }

        function toggleFields() {
            const s = document.getElementById('servicioSelect').value;
            const mods = {
                laboral: document.getElementById('camposLaborales'),
                inmuebles: document.getElementById('camposInmuebles'),
                vehiculos: document.getElementById('camposVehiculos'),
                transito: document.getElementById('camposTransito'),
                salud: document.getElementById('camposSalud'),
                civil: document.getElementById('camposCivil')
            };
            Object.values(mods).forEach(d => { if(d) {d.classList.add('hidden'); setRequired(d, false);} });
            
            // ID Contraparte siempre requerido
            const idContraparte = document.querySelector('input[name="Contraparte_ID"]');
            if(idContraparte) idContraparte.required = true;

            if (s.includes("Laboral")) show(mods.laboral);
            else if (s.includes("Inmuebles")) show(mods.inmuebles);
            else if (s.includes("Veh√≠culos")) show(mods.vehiculos);
            else if (s.includes("Tr√°nsito")) show(mods.transito);
            else if (s.includes("Salud")) show(mods.salud);
            else if (s.includes("Cobro")) show(mods.civil);
        }

        function show(div) { if(div) { div.classList.remove('hidden'); setRequired(div, true); } }
        function setRequired(div, isReq) { div.querySelectorAll('input, select').forEach(i => i.required = isReq); }

        // ==========================================
        // 4. L√ìGICA DE PAGO Y GENERACI√ìN (EL CORAZ√ìN)
        // ==========================================
        const form = document.getElementById('legalForm');
        const statusDiv = document.getElementById('statusMessage');
        const submitBtn = document.getElementById('submitBtn');

        // A. CUANDO EL USUARIO HACE CLIC EN "PAGAR Y GENERAR"
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // 1. Validar que Wompi carg√≥
            if (typeof WidgetCheckout === 'undefined') {
                alert("El sistema de pagos est√° cargando. Espere 3 segundos e intente de nuevo.");
                return;
            }

            // 2. Guardar datos en la 'Caja Fuerte' del navegador
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            data.MarcaTemporal = new Date().toISOString();
            localStorage.setItem('datos_pendientes_guanes', JSON.stringify(data));

            // 3. Abrir Wompi
            const referenciaUnica = 'GUANES_' + Date.now();
            const checkout = new WidgetCheckout({
                currency: 'COP',
                amountInCents: PRECIO_DOCUMENTO,
                reference: referenciaUnica,
                publicKey: WOMPI_PUBLIC_KEY,
                redirectUrl: window.location.href // Vuelve a esta misma p√°gina
            });
            
            checkout.open(function (result) {
                const transaction = result.transaction;
                if (transaction.status === 'APPROVED') {
                    // Si el pago es exitoso dentro del widget (sin redirecci√≥n)
                    data.Transaccion_ID = transaction.id; // Guardamos el ID
                    procesarGeneracion(data);
                }
            });
        });

        // B. CUANDO EL CLIENTE VUELVE DE WOMPI (REDIRECCI√ìN)
        window.onload = function() {
            // Revisamos si en la URL hay un ?id= de Wompi
            const urlParams = new URLSearchParams(window.location.search);
            const wompiId = urlParams.get('id');
            
            if (wompiId) {
                // Verificar si tenemos datos guardados
                const datosGuardados = localStorage.getItem('datos_pendientes_guanes');
                if (datosGuardados) {
                    const data = JSON.parse(datosGuardados);
                    data.Transaccion_ID = wompiId; // Guardamos el ID
                    
                    statusDiv.style.display = 'block';
                    statusDiv.innerHTML = '<h3>üí∞ Pago Detectado</h3><p>Validando y generando documento...</p>';
                    
                    // Limpiamos la URL para que no se vea fea
                    window.history.replaceState({}, document.title, "/");
                    
                    // Disparamos la generaci√≥n
                    procesarGeneracion(data);
                }
            }
        };

        // C. FUNCI√ìN QUE LLAMA A LA IA (SOLO SI PAG√ì)
        async function procesarGeneracion(data) {
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> GENERANDO PDF...';
            statusDiv.style.display = 'block';
            statusDiv.style.background = '#eff6ff';
            statusDiv.innerHTML = '<h3>‚öñÔ∏è Redactando Documento...</h3><p>El Dr. Virtual est√° trabajando en su caso. Por favor espere (aprox. 30 seg).</p>';

            try {
                const response = await fetch(WEBHOOK_FORMULARIO, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `Documento_GUANES_${data.Nombre.replace(/\s+/g, '_')}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    
                    statusDiv.innerHTML = '<h3>‚úÖ ¬°LISTO!</h3><p>Su documento se ha descargado exitosamente. Gracias por confiar en GUANES.</p>';
                    localStorage.removeItem('datos_pendientes_guanes'); // Borrar la caja fuerte
                    form.reset();
                } else { throw new Error('Error en respuesta'); }
            } catch (error) {
                console.error(error);
                statusDiv.style.background = '#fef2f2';
                statusDiv.style.color = '#dc2626';
                statusDiv.innerHTML = '<h3>‚ö†Ô∏è ATENCI√ìN</h3><p>Su pago fue recibido pero hubo un error t√©cnico generando el PDF. Cont√°ctenos con su comprobante para enviarlo manualmente.</p>';
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-credit-card"></i> PAGAR $50.000 Y GENERAR';
            }
        }
    </script>
</body>
</html>